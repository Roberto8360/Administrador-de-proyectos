@{
    ViewData["Title"] = "ReporteProyecto Page";
}

<style>
    #btnProyecto {
        font-size: 1.5rem;
        font-weight: bold;
    }

    #listaModulos li {
        font-size: 1.1rem;
    }
</style>

<h2 class="mb-4">Reporte de Proyecto</h2>

@* Acordeon de Reporte Proyecto *@
<div class="container mt-4">
    <h2>
        <button id="btnProyecto" class="btn btn-outline-primary">
            <span id="nombreProyecto"></span>
        </button>
    </h2>

    <p id="horasTotalesProyecto" class="mt-2"></p>

    <!-- Contenedor de módulos oculto inicialmente -->
    <div id="contenedorModulos" class="mt-4 d-none">
        <ul id="listaModulos" class="list-group"></ul>
    </div>
</div>


<script>
          let modulosGuardados = [];

    document.addEventListener('DOMContentLoaded', function () {
        const params = new URLSearchParams(window.location.search);
        const proyectoId = parseInt(params.get('id'), 10);

        if (!isNaN(proyectoId)) {
            cargarDatosDelProyecto(proyectoId);
        } else {
            console.error("ID de proyecto inválido");
        }

        // Asignar evento al botón después del DOM y la data estar listos
        document.getElementById('btnProyecto').addEventListener('click', function () {
            const contenedor = document.getElementById('contenedorModulos');
            contenedor.classList.toggle('d-none');
        });
    });

    function cargarDatosDelProyecto(id) {
        $.ajax({
            url: `/Reporte/ObtenerDatosDelProyecto?id=${id}`,
            method: 'GET',
            success: function (data) {
                mostrarNombreProyecto(data.proyectoNombre);
                mostrarHorasTotales(data.modulos);
                modulosGuardados = data.modulos; // Guardar para mostrar
                construirListaDeModulos(modulosGuardados);
            },
            error: function () {
                console.error("Error al cargar los datos del proyecto.");
            }
        });
    }

    function mostrarNombreProyecto(nombre) {
        const titulo = document.getElementById('nombreProyecto');
        titulo.textContent = nombre || "Proyecto sin nombre";
    }

    function mostrarHorasTotales(modulos) {
        const totalHoras = modulos.reduce((sum, modulo) => sum + modulo.horas, 0);
        const contenedorHoras = document.getElementById('horasTotalesProyecto');
        contenedorHoras.textContent = `Horas totales del proyecto: ${totalHoras.toFixed(2)} hrs`;
    }

    function construirListaDeModulos(modulos) {
        const lista = document.getElementById('listaModulos');
        lista.innerHTML = '';

        modulos.forEach(modulo => {
            const item = document.createElement('li');
            item.className = 'list-group-item d-flex justify-content-between align-items-center';
            item.innerHTML = `
                <span>${modulo.nombre}</span>
                <span class="badge bg-primary rounded-pill">${modulo.horas} hrs</span>
            `;
            lista.appendChild(item);
        });
    }



</script>